<!doctype html>
<html lang="zh">
{% include 'head.html' %}

<body>
    <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
        {% include 'header.html' %} {% include 'drawer.html' %}
        <main class="mdl-layout__content mdl-color--grey-100">
            <div class="mdl-grid demo-content">
                <div class="mdl-cell mdl-cell--12-col">
                    <h3>cat</h3>
                    <span>cat.nyan.im</span><br>
                    <span class="mdl-chip">
                            <span class="mdl-chip__text">online</span>
                    </span>
                    <span class="mdl-chip">
                            <span class="mdl-chip__text">Ping: 23.44</span>
                    </span>
                    <div id="pingchart" style="width: 100%;height:400px;"></div>
                    <div id="servicechart" style="width: 100%;height:400px;"></div>
                    <table width=100% class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
                        <thead>
                            <tr>
                                <th class="mdl-data-table__cell--non-numeric">服务</th>
                                <th>Agent</th>
                                <th>URL</th>
                                <th>HTTP</th>
                                <th>HTTPS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="mdl-data-table__cell--non-numeric">cat</td>
                                <td>vtr</td>
                                <td>http://cat.nyan.im/</td>
                                <td>online</td>
                                <td>offline</td>
                            </tr>
                            <tr>
                                <td class="mdl-data-table__cell--non-numeric">blog</td>
                                <td>vtr</td>
                                <td>https://blog.nyan.im/</td>
                                <td>online</td>
                                <td>online</td>
                            </tr>
                        </tbody>
                    </table>
                    <div>
                        <h4>server: {{ result['servers'][0].name }}</h4>
                        {{ result['servers'][0].server }} 
                        <br>
                        {% for i in result['servers'] %} 
                        {{ i.status }} &nbsp; {{ i.ping }} &nbsp; {{i.agent}} &nbsp; {{ i.time }} 
                        <br>
                        {% endfor %}
                        <h4>services</h4>
                        {% for services in result['services'] %} 
                        {% for i in services %} 
                        {{ i.name }} {{ i.url }} {{ i.http }} {{ i.https }} {{ i.time }}  
                        <br>
                        {% endfor %}
                        <br>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script>
        // 基于准备好的dom，初始化echarts实例
        $.ajax({
            url:'/api/get_server_data/cat/72',
            success : function(result){
                var pingChart = echarts.init(document.getElementById('pingchart'));

                var series = [];
                for (var i in result){
                    data = [];
                    for (var j=0;j<result[i].data.length;j++){
                        data.push([result[i].date[j],result[i].data[j]]);
                    }
                    series.push({
                        name: i,
                        type:'line',
                        smooth:true,
                        data: data 
                    })
                }

                // 指定图表的配置项和数据
                var server_option = {
                    title: {
                        text: "{{ result['servers'][0].server }}"
                    },
                    tooltip: {},
                    legend: {
                        //data:['销量']
                    },
                    xAxis: {
                        type:'time'
                    },
                    yAxis: {},
                    series: series
                };

                // 使用刚指定的配置项和数据显示图表。
                pingChart.setOption(server_option);
            }
        });
    </script>
    <script>
        $.ajax({
            url:'/api/get_service_data/test/72',
            success : function(result){
                var serviceChart = echarts.init(document.getElementById('servicechart'));
                data = result.data.map(function (item) {
                    return [item[1], item[0], item[2] || '-'];
                });
                console.log(data)
                
                var service_option = {
                    tooltip: {
                        position: 'top'
                    },
                    animation: false,
                    grid: {
                        height: '50%',
                        y: '10%'
                    },
                    xAxis: {
                        type: 'category',
                        data: result.time,
                        splitArea: {
                            show: true
                        }
                    },
                    yAxis: {
                        type: 'category',
                        data: ['http','https'],
                        splitArea: {
                            show: true
                        }
                    },
                    visualMap: {
                        min: 0,
                        max: 2,
                        calculable: true,
                        orient: 'horizontal',
                        left: 'center',
                        bottom: '15%'
                    },
                    series: [{
                        name: 'Punch Card',
                        type: 'heatmap',
                        data: data,
                        label: {
                            normal: {
                                show: true
                            }
                        },
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }]
                };
                serviceChart.setOption(service_option);
            }
        });
    </script>
</body>

</html>